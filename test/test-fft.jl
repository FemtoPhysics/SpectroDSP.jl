import SpectroDSP: FFT

@testset "Twiddle Factors" begin
    @test FFT.twiddle!(Vector{ComplexF64}(undef, 1)) == ComplexF64[1.0 + 0.0im]
    @test FFT.twiddle!(Vector{ComplexF64}(undef, 2)) == ComplexF64[1.0 + 0.0im, 0.0 - 1.0im]
    let tmp = 0.5 * sqrt(2.0)
        @test FFT.twiddle!(Vector{ComplexF64}(undef, 4)) == ComplexF64[
            1.0 + 0.0im, complex(tmp, -tmp), 0.0 - 1.0im, complex(-tmp, -tmp)
        ]
    end
    @test FFT.twiddle!(Vector{ComplexF64}(undef, 8)) ≈ ComplexF64[
         1.0 + 0.0im,
         0.9238795325112867 - 0.3826834323650898im,
         0.7071067811865476 - 0.7071067811865476im,
         0.3826834323650898 - 0.9238795325112867im,
         0.0 - 1.0im,
        -0.3826834323650898 - 0.9238795325112867im,
        -0.7071067811865476 - 0.7071067811865476im,
        -0.9238795325112867 - 0.3826834323650898im
    ]
end

@testset "Radix-2 FFT" begin
    dat = [1.0 + 0.0im,  2.0 - 1.0im, 0.0 - 1.0im, -1.0 + 2.0im]
    ans = [2.0 + 0.0im, -2.0 - 2.0im, 0.0 - 2.0im,  4.0 + 4.0im]

    @test ans == FFT.fft(dat, FFT.Radix2FFT(4))
end

@testset "Radix-2 IFFT" begin
    dat = [2.0 + 0.0im, -2.0 - 2.0im, 0.0 - 2.0im,  4.0 + 4.0im]
    ans = [1.0 + 0.0im,  2.0 - 1.0im, 0.0 - 1.0im, -1.0 + 2.0im]

    @test ans == FFT.ifft(dat, FFT.Radix2FFT(4))
end

@testset "NonRadix-2 FFT" begin
    dat = [27.0,  19.0, -15.0,  -7.0,   8.0, -19.0, -12.0,   0.0,
           19.0,   4.0,  15.0,  16.0, -29.0, -32.0,  28.0,  22.0,
           14.0, -10.0, -14.0,  -1.0, -30.0,  13.0,  -3.0, -12.0,
           32.0, -20.0,  17.0, -27.0]
    ans = [+  3.0000000000000000 +  0.0000000000000000im,
           -  0.8601409360718346 -  18.0989905308315002im,
           + 44.7638000658088657 +  46.9039566435309467im,
           + 19.1684046064954181 +  58.6285247155330609im,
           + 31.6704296523762387 - 163.3080657748329827im,
           - 17.4234003511821278 +  73.7957389451071748im,
           + 68.9220021683557036 -  92.1139664154089957im,
           + 25.0000000000000000 +  36.0000000000000071im,
           +127.2004407152516876 - 112.7860248263031195im,
           - 30.3396367038266952 -  18.5175634175108783im,
           - 22.1858022341645729 -   5.1755233940802441im,
           - 78.8903461334995484 - 145.8183433180072939im,
           + 77.6291296323720843 -  89.5686231710824501im,
           + 76.3451195180848003 +   2.6309964007609921im,
           +111.0000000000000000 +   0.0000000000000040im,
           + 76.3451195180847861 -   2.6309964007609770im,
           + 77.6291296323720843 +  89.5686231710824501im,
           - 78.8903461334995484 + 145.8183433180072939im,
           - 22.1858022341645764 +   5.1755233940802423im,
           - 30.3396367038266845 +  18.5175634175108783im,
           +127.2004407152516876 + 112.7860248263031195im,
           + 24.9999999999999964 -  35.9999999999999929im,
           + 68.9220021683557178 +  92.1139664154089957im,
           - 17.4234003511821314 -  73.7957389451071748im,
           + 31.6704296523762387 + 163.3080657748329827im,
           + 19.1684046064954181 -  58.6285247155330609im,
           + 44.7638000658088586 -  46.9039566435309467im,
           -  0.8601409360718382 +  18.0989905308314931im]

    @test ans ≈ FFT.fft(dat, FFT.NonRadix2FFT(length(dat)))
end
